<!DOCTYPE html>
<HTML LANG="EN">
<head>
    <meta charset="UTF-8">
    <title>게시판</title>
    <link rel="stylesheet" th:href="@{/css/reset.css}">
    <link rel="stylesheet" id="theme-stylesheet" th:href="@{/css/post/selectpost-light.css}">
    <link rel="stylesheet" id="theme-stylesheet-mypage" th:href="@{/css/mypage/mypage-light.css}">
    <style>

        .ellipsis {
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }

        .blur{
            filter: blur(7.5px);
        }
        .dn{
            display: none;
        }
        .db{
            display: block;
        }
    </style>
</head>
<body data-user-id="${user.id}">
<header>
    <nav>
        <!--네비바-->
        <img th:src="@{/images/main/nav-logo-light.png}" alt="상단 로고" onclick="window.location.href='/'" id="nav-logo">
        <span onclick="location.href='/intro'">소개</span>
        <span onclick="location.href='/notice'">공지사항</span>
        <span onclick="location.href='/post'">게시판</span>
        <span onclick="location.href='/mbti'">MBTI 검사</span>
        <span id="mypageBtn">마이페이지</span>
        <form th:action="@{/auth/logout}" method="post">
            <button id="logoutNav" type="submit">로그아웃</button>
        </form>
        <span onclick="location.href='/auth/signupterms'">회원가입</span>
    </nav>
</header>

<aside id="myPageAside">
    <img th:src="@{${userInfo.profileImage != null ? userInfo.profileImage : '/images/mypageimages/profile.png'}}" alt="프로필 사진" class="profile-photo" id="profilePhoto3">
    <p id="nickname" class="nicknamefont">닉네임 : <span th:text="${myPageDTO.userName}"></span></p>
    <p id="rank" class="rankfont">등급: <span th:text="${userLevel}"></span></p>
    <p class="infofont" id="info">개인 정보</p>
    <p class="activefont" id="active">활동 기록</p>
    <p class="MBTIfont" id="mbtiButton">MBTI</p>
    <div id="mbtiContent" style="display: none;">
        <div id="myMBTI" class="mbti-item">
            -- 나의 MBTI
        </div>
        <div class="mbti-item2" onclick="location.href='/mbti'">-- MBTI 검사</div>
    </div>
    <form th:action="@{/auth/logout}" method="post">
        <button class="logoutFont" type="submit">로그아웃</button>
    </form>
</aside>
<div class="rankpopup" id="rank-popup">
    <p class="scorefont">출석 횟수 : <span th:text="${attendanceCount}"></span></p>
    <p class="nextfont">다음 등급 : <span th:text="${nextLevelName}"></span></p>
    <p class="needfont">필요 출석 : <span th:text="${nextLevelRequiredAttendance}"></span></p>
</div>

<div class="modal-background" id="modal-background">
    <div class="pwdpopup" id="pwd-popup">
        <p class="pwdfont">비밀번호를 입력하여 본인임을 확인해 주세요!</p>
        <div class="pwd-container">
            <span class="pwdfont2">비밀번호</span> <input type="password" id="pwdInput" placeholder="영문,숫자,특수문자 8~12자리">
            <span class="toggle-password" id="togglePassword"><img id="passwordIcon" src="/images/icon/closeEye.png" alt="eye-icon" /></span>
        </div>

        <div class="popup-buttons">
            <button id="closePopupBtn" class="cancle-btn">취소</button>
            <button id="submitPasswordBtn" class="confirm-btn">확인</button>
        </div>

    </div>
</div>
<div class="mbtipopup" id="mbtiPopup">
    <p class="horrormbti">나의 공포 MBTI</p>
    <p class="mbticategory" th:text="${mbtiInfo.MBTI_TYPE}"></p>
    <div class="mbtiexp">
        <p class="mtbtiexp2" th:text="${mbtiInfo.MBTI_INFO}"></p>
    </div>
</div>
<main>
    <div class="qickBtn">
        <!--플로팅 버튼-->
        <img th:src="@{/images/main/folating-btn-light.png}" id="light" class="tr" alt="플로팅 버튼">
        <img th:src="@{/images/main/folating-btn-click-light.png}" class="dn tr" id="dark" alt="플로팅 버튼 클릭">
        <div class="clikbtn tr">
            <img th:src="@{/images/main/top-btn-light.png}" class="dn" id="top" alt="탑버튼">
            <img th:src="@{/images/main/light-btn-light.png}" class="dn" id="mode" onclick="toggleMode()" alt="테마 변경">
            <img th:src="@{/images/main/test-btn-light.png}" class="dn" id="test" alt="MBTI 테스트">
        </div>
    </div>
    <div class="post">
        <div id="header">
            <span>
                <img th:src="@{/images/post/best-light.png}" th:if="${post.postFavorite}" th:attr="data-postNo=${post.postNo}"
                     class="favorite-icon" onclick="toggleFavorite(this)">
                <img th:src="@{/images/post/best-none-light.png}" th:unless="${post.postFavorite}" th:attr="data-postNo=${post.postNo}"
                     class="favorite-icon" onclick="toggleFavorite(this)">
            </span>
            <span th:text="${post.postNo}" id="no"></span>
            <span th:text="${post.postTitle}" id="title"></span>
            <script>
                window.addEventListener('load', () => {
                    const title = document.getElementById("title");
                    const no = document.getElementById("no");

                    const checkTitleWidth = () => {
                        const titleWidth = title.offsetWidth;
                        if (titleWidth > 1000) {
                            title.style.fontSize = '35px';
                            title.style.marginTop='15px';
                            no.style.marginTop='15px';
                            title.style.marginLeft='130px';
                            no.style.fontSize = '35px';
                        } else {
                            title.style.fontSize = ''; // 기본 폰트 크기로 되돌림
                        }
                    };

                    // 페이지 로드 시 및 윈도우 리사이즈 시 폰트 크기 체크
                    checkTitleWidth();
                    window.addEventListener('resize', checkTitleWidth);
                });
            </script>
            <span>작성날짜 : </span>
            <span th:text="${post.postDate}"></span>

            <div th:if="${userInfo.userName} != ${post.postWriterName}" id="reports">
                <img th:src="@{/images/post/selectpost/reportbtn-light.png}">
                <span>신고</span>
            </div>
        </div>
        <div class="line"></div>
        <div id="content">
            <span th:text="${post.postContent}"></span>

            <!-- 이미지 경로 설정 -->
            <img class="blur" id="img1" th:data-src="@{${post.postImageFirst}}" alt="첫 번째 이미지">
            <img class="blur" id="img2" th:data-src="@{${post.postImageSecond}}" alt="두 번째 이미지">


        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const img1 = document.getElementById('img1');
                const img2 = document.getElementById('img2');

                if (img1 && img1.dataset.src) {
                    img1.src = img1.dataset.src + `?t=${new Date().getTime()}`;
                }else {
                    img1.style.display='none';
                }

                if (img2 && img2.dataset.src) {
                    img2.src = img2.dataset.src + `?t=${new Date().getTime()}`;
                }else {
                    img2.style.display='none';
                }
            });
        </script>


        <script>

            const img1 = document.getElementById("img1");
            const img2 = document.getElementById("img2");

            if (img1 !== null) {
                img1.addEventListener('click', () => {
                    img1.classList.toggle("blur");
                });
            }

            if (img2 !== null) {
                img2.addEventListener('click', () => {
                    img2.classList.toggle("blur");
                });
            }
        </script>

        <div id="box">
            <div id="writer" class="post-user">

                <div th:if="${userInfo.userName} == ${post.postWriterName}">
                    <img th:src="@{${userInfo.profileImage != null ? userInfo.profileImage : post.profileImage}}"
                         alt="프로필 사진" class="profile-photo2" id="profilePhoto">
                </div>
                <div th:if="${userInfo.userName} != ${post.postWriterName}">
                    <img th:src="@{${post.profileImage != null ? post.profileImage : '/images/mypageimages/profile.png'}}"
                         alt="프로필 사진" class="profile-photo2" id="profilePhoto1">
                </div>

                <span th:text="${userInfo.level}"></span>
                <span th:text="${post.postWriterName}"></span>
                <span> <img th:src="@{/images/post/selectpost/badge.png}">
            </span> <div> <span th:text="${post.postCategory}"></span>
            </div>
            </div>
            <div id="scary">
                <img th:src="@{/images/post/selectpost/scary-btn-before-light.png}"
                     th:if="${!post.scary}"
                     th:attr="data-postNo=${post.postNo}, data-state='before'"
                     class="scary-icon" onclick="toggleScary(this)" id="sc-b">
                <img th:src="@{/images/post/selectpost/scary-btn-after-light.png}"
                     th:if="${post.scary}"
                     th:attr="data-postNo=${post.postNo}, data-state='after'"
                     class="scary-icon" onclick="toggleScary(this)" id="sc-a">
                <div>
                    <span>무서워요</span>
                </div>
                <span id="scary-number-${post.postNo}" th:text="${post.scaryNumber}"></span>
            </div>

            <div id="notscary">
                <img th:src="@{/images/post/selectpost/not-scary-btn-before-light.png}"
                     th:if="${!post.notScary}"
                     th:attr="data-postNo=${post.postNo}, data-state='before'"
                     class="notscary-icon" onclick="toggleNotScary(this)" id="nsc-b">
                <img th:src="@{/images/post/selectpost/not-scary-btn-after-light.png}"
                     th:if="${post.notScary}"
                     th:attr="data-postNo=${post.postNo}, data-state='after'"
                     class="notscary-icon" onclick="toggleNotScary(this)" id="nsc-a">
                <div>
                    <span>안무서워요</span>
                </div>
                <span id="not-scary-number-${post.postNo}" th:text="${post.notScaryNumber}"></span>

            </div>







            <div class="line2"></div>

            <!-- 댓글 작성 영역 -->
            <div id="comment-section">
                <input type="text" id="comment-input" placeholder="댓글을 입력하세요..." />
                <button onclick="submitComment()">댓글 작성</button>
            </div>

            <!-- 댓글 더보기 버튼 -->
            <div class="show-more-comments">
                <span onclick="loadComments()">댓글 보기</span>
            </div>

            <!-- 댓글 목록 -->
            <div id="comments-list" style="display: none;">
                <div th:each="comment : ${comments}">
                    <div class="comment">
                        <div th:if="${userInfo.userName} == ${post.postWriterName}">
                            <img th:src="@{profileImage}"
                                 alt="프로필 사진" class="profile-photo2" id="profilePhoto2">
                        </div>
                        <div th:if="${userInfo.userName} != ${post.postWriterName}">
                            <img th:src="@{profileImage}"
                                 alt="프로필 사진" class="profile-photo2" id="profilePhoto4">
                        </div>

                        <span th:text="${comment.username}"></span>
                        <span th:text="${comment.userLevel}"></span>
                        <span th:text="${comment.commentContent}"></span>
                        <span th:text="${comment.commentDate}"></span>

                        <div id="like">
                            <img th:src="@{/images/post/selectpost/like-btn-before-light.png}" th:if="${!comment.like}"
                                 th:attr="data-comment-no=${comment.commentNo}"
                                 class="likeImg" onclick="toggleLike(this)" id="likes">
                            <img th:src="@{/images/post/selectpost/like-btn-after.png}" th:if="${comment.like}"
                                 th:attr="data-comment-no=${comment.commentNo}"
                                 class="likeImg" onclick="toggleLike(this)">
                            <div class="like-count" th:if="${comment.likeNumber > 0}">
                                <span th:text="${comment.likeNumber}"></span>
                            </div>
                            <div class="like-text" th:if="${comment.likeNumber == 0}">
                                <span>좋아요</span>
                            </div>
                        </div>


                        <div th:if="${comment.userNo} != ${userNo}" id="report">
                            <img th:src="@{/images/post/selectpost/reportbtn-light.png}" class="report">
                            <span>신고</span>
                        </div>

                        <button class="delete-comment-btn"
                                th:data-comment-no="${comment.commentNo}"
                                th:if="${comment.userNo == userNo}">
                            삭제
                        </button>

                        <button class="edit-comment-btn"
                                th:data-comment-no="${comment.commentNo}"
                                th:if="${comment.userNo == userNo}">
                            수정
                        </button>
                    </div>
                </div>
            </div>



        </div>
    </div>
    <div class="bg"></div>

    <!--    <button type="button" onclick="editPost()" id="editBtn">수정</button>-->
    <!--    <button type="button" id="deleteBtn" th:data-post-no="${post.postNo}">삭제</button>-->

    <div th:if="${userInfo.userName} == ${post.postWriterName}">
        <div class="modifyModal">
            <button type="button" onclick="showEditModal()" id="editBtn">수정</button>
            <div class="modify dn">
                <div class="modal-bg">
                    <p>게시물을 수정 하시겠습니까?</p>
                    <a th:href="@{/edit/{postNo}(postNo=${post.postNo})}">
                        <button class="yes" id="yesEdit">확인</button>
                    </a>
                    <button class="return" onclick="closeEditModal()">취소</button>
                </div>
            </div>
        </div>
        <div class="deleteModal">
            <!-- 삭제 버튼 -->
            <button type="button" id="deleteBtn" th:data-post-no="${post.postNo}" onclick="showDeleteModal()">삭제</button>

            <!-- 모달 -->
            <div class="delete1 dn">
                <div class="modal-bg">
                    <p>게시물을 삭제 하시겠습니까?</p>

                    <!-- 삭제 확인 버튼 -->
                    <button type="button" class="yes" id="yesDelete" onclick="confirmDelete()">확인</button>

                    <!-- 삭제 취소 버튼 -->
                    <button class="return" onclick="closeDeleteModal()">취소</button>
                </div>
            </div>
        </div>


    </div>
</main>


<footer>
    <div class="footer">
        <p>ⓒ 2024 MergePing. All right reserved. </p>
    </div>
</footer>
<script>
    // JavaScript로 토글 기능 추가
    const mypageBtn = document.getElementById("mypageBtn");
    const myPageAside = document.getElementById("myPageAside");

    // 버튼 클릭 시 aside 창 표시/숨김 전환
    mypageBtn.addEventListener("click", () => {
        if (myPageAside.classList.contains("show")) {
            // 보이는 상태라면 숨기기
            myPageAside.classList.remove("show");
            setTimeout(() => {
                myPageAside.style.display = "none"; // 애니메이션 후 display를 none으로
            }, 400); // transition과 동일한 시간 설정
        } else {
            // 숨겨진 상태라면 보이게 하기
            myPageAside.style.display = "block"; // 먼저 display를 block으로 설정
            setTimeout(() => {
                myPageAside.classList.add("show");
            }, 10); // 약간의 지연 시간 후에 show 클래스 추가
        }
    });

    const gradeElement = document.getElementById('rank');
    const popup = document.getElementById('rank-popup');

    gradeElement.addEventListener('mouseenter', () => {
        popup.style.display = 'block'; // 팝업 표시
    });

    gradeElement.addEventListener('mouseleave', () => {
        popup.style.display = 'none'; // 팝업 숨기기
    });

    const personalInfoBtn = document.getElementById('info');
    const passwordPopup = document.getElementById('pwd-popup');
    const closePopupBtn = document.getElementById('closePopupBtn');
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('pwdInput');
    const submitPasswordBtn = document.getElementById('submitPasswordBtn');
    const modal = document.querySelector('.modal-background');
    const passwordIcon = document.getElementById('passwordIcon');

    //모달
    personalInfoBtn.addEventListener('click', () => {
        passwordPopup.style.display = 'block';// 비밀번호 팝업 표시
        document.body.style.overflow = "hidden"; // 스크롤 비활성화
    });

    personalInfoBtn.addEventListener("click", () => {
        modal.style.display = "flex";
        if (modal.style.display === "flex") {
            closePopupBtn.addEventListener("click", () => {
                modal.style.display = "none";
                document.body.style.overflow = "auto"; // 스크롤 다시 활성화
            });
        }
    });


    // 비밀번호 보기/숨기기 토글
    togglePassword.addEventListener('click', () => {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        passwordIcon.src = type === 'password' ? '/images/icon/closeEye.png' : '/images/icon/openEye.png';
    });


    submitPasswordBtn.addEventListener('click', () => {
        const inputPassword = passwordInput.value;

        // 비밀번호 검증 요청
        fetch('/verifyPassword', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams({ inputPassword })
        })
            .then(response => response.json())
            .then(isPasswordCorrect => {
                if (isPasswordCorrect) {
                    // 비밀번호가 맞으면 개인정보 페이지로 이동
                    location.href = '/userinfo';
                } else {
                    // 비밀번호가 틀리면 경고 메시지 표시
                    alert('비밀번호가 일치하지 않습니다.');
                }
            })
            .catch(error => {
                console.error('비밀번호 검증 요청 실패:', error);
                alert('비밀번호 확인 중 오류가 발생했습니다.');
            });
    });

    const activebtn = document.getElementById('active');
    activebtn.addEventListener('click', () => {
        // URL을 원하는 주소로 변경하세요
        location.href = '/useractive';
    });

    const mbtiButton = document.getElementById("mbtiButton");
    const mbtiContent = document.getElementById("mbtiContent");
    const myMBTI = document.getElementById("myMBTI");
    const mbtiPopup = document.getElementById("mbtiPopup");

    // MBTI 버튼 클릭 시 MBTI 콘텐츠 표시
    mbtiButton.addEventListener("click", () => {
        // 콘텐츠 표시 상태를 토글
        mbtiContent.style.display = mbtiContent.style.display === "none" ? "block" : "none";
    });

    // 나의 MBTI 요소에 마우스 올렸을 때 팝업 표시
    myMBTI.addEventListener("mouseenter", () => {
        mbtiPopup.style.display = "block";
    });

    // 나의 MBTI 요소에서 마우스 나갔을 때 팝업 숨기기
    myMBTI.addEventListener("mouseleave", () => {
        mbtiPopup.style.display = "none";
    });
</script>
<script>
    const editBtn = document.getElementById("editBtn");
    const modify = document.querySelector(".modify");
    const deleteBtn = document.getElementById("deleteBtn");
    const delete1 = document.querySelector(".delete1");

    function showEditModal() {
        console.log("showEditModal called");
        // closeDeleteModal(); // 다른 모달창 닫기
        modify.classList.remove("dn");
        console.log("modify.classList:", modify.classList);
    }

    function closeEditModal() {
        console.log("closeEditModal called");
        modify.classList.add("dn");
        console.log("modify.classList:", modify.classList);
    }

    // 게시물 삭제 요청
    function confirmDelete() {
        const deleteBtn = document.getElementById("deleteBtn");
        const postNo = deleteBtn.getAttribute("data-post-no");

        if (postNo) {
            fetch(`/post/${postNo}/delete`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("네트워크 응답이 실패했습니다.");
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        alert(data.message || "게시물이 삭제되었습니다.");
                        window.location.href = "/post"; // 게시물 목록 페이지로 이동
                    } else {
                        alert(data.error || "게시물 삭제에 실패했습니다.");
                    }
                })
                .catch(error => console.error("Error:", error));
        } else {
            console.error("Post number is missing!");
        }
    }

    function showDeleteModal() {
        // console.log(showDeleteModal());
        // closeEditModal(); // 다른 모달창 닫기
        delete1.classList.remove("dn");
        console.log("delete1.classList:", delete1.classList);
    }

    function closeDeleteModal() {
        // console.log(closeDeleteModal());
        delete1.classList.add("dn");
        console.log("delete1.classList:", delete1.classList);
    }

    // // 삭제 버튼 클릭 이벤트 설정
    // document.getElementById("deleteBtn").addEventListener("click", function () {
    //     const postNo = document.getElementById("deleteBtn").getAttribute("data-post-no");
    //     deletePost(postNo);
    // });
</script>

<script>
    window.onload = function() {
        fetchComments();
    };

    function fetchComments() {
        const postNo = [[${post.postNo}]];  // 현재 게시물의 번호를 할당합니다.
        fetch(`/api/comments/${postNo}`)
            .then(response => response.json())
            .then(data => {
                addCommentToDOM(data.comments, data.userProfileImage);
            })
            .catch(error => {
                console.error('Error fetching comments:', error);
            });
    }
</script>
<script>
    function submitComment() {
        const commentInput = document.getElementById("comment-input");
        const commentContent = commentInput.value.trim();

        if (!commentContent) {
            alert("댓글 내용을 입력해주세요.");
            return;
        }

        const postNo = document.querySelector(".favorite-icon").getAttribute("data-postNo");


        fetch(`/selectpost/${postNo}/comment`, {
            method: "POST",
            body: new URLSearchParams({
                commentContent: commentContent,

            })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (Array.isArray(data.comments)) {
                        addCommentToDOM(data.comments,data.userProfileImage);  // 댓글 목록을 DOM에 추가
                    } else {
                        console.error("댓글 목록이 배열이 아닙니다:", data.comments);
                    }
                    commentInput.value = "";
                } else {
                    alert(data.error || "댓글 작성에 실패했습니다.");
                }
            })
            .catch(error => console.error("Error:", error));
    }

    function deleteComment(commentNo) {
        const postNo = document.querySelector(".favorite-icon").getAttribute("data-postNo");

        if (confirm("댓글을 삭제하시겠습니까?")) {
            fetch(`/selectpost/${postNo}/comment/${commentNo}/delete`, {
                method: "DELETE"
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error("네트워크 응답이 실패했습니다.");
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        if (Array.isArray(data.comments)) {
                            addCommentToDOM(data.comments);  // 최신 댓글 목록으로 갱신
                        } else {
                            console.error("댓글 목록이 배열이 아닙니다:", data.comments);
                        }
                        adjustFooterPosition();
                    } else {
                        alert(data.error || "댓글 삭제에 실패했습니다.");
                    }
                })
                .catch(error => console.error("Error:", error));
        }
    }
    // 댓글 수정 함수
    function editComment(commentNo) {
        // 수정할 댓글의 내용을 가져옴
        const commentDiv = document.querySelector(`.comment [data-comment-no="${commentNo}"]`).closest('.comment');

        console.log(commentDiv);

        const currentContent = commentDiv.querySelector("span:nth-child(4)").textContent;

        console.log(currentContent);


        // 댓글 수정 창을 띄우기 위해 prompt를 사용
        const newContent = prompt("댓글을 수정하세요:", currentContent);

        if (newContent && newContent !== currentContent) {
            const postNo = document.querySelector(".favorite-icon").getAttribute("data-postNo");

            // 서버에 수정된 댓글 전송
            fetch(`/selectpost/${postNo}/comment/${commentNo}/edit`, {
                method: "PUT",
                body: new URLSearchParams({
                    commentContent: newContent,
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        if (Array.isArray(data.comments)) {
                            addCommentToDOM(data.comments);  // 최신 댓글 목록으로 갱신
                        } else {
                            console.error("댓글 목록이 배열이 아닙니다:", data.comments);
                        }
                    } else {
                        alert(data.error || "댓글 수정에 실패했습니다.");
                    }
                })
                .catch(error => console.error("Error:", error));
        }
    }
    // 이벤트 위임을 통해 삭제 버튼의 클릭 이벤트 처리
    document.getElementById("comments-list").addEventListener("click", function (event) {
        if (event.target.classList.contains("delete-comment-btn")) {
            const commentNo = event.target.getAttribute("data-comment-no");
            deleteComment(commentNo);
        } else if (event.target.classList.contains("edit-comment-btn")) {
            const commentNo = event.target.getAttribute("data-comment-no");
            editComment(commentNo);
        }
    });
    function adjustFooterPosition() {
        const commentsList = document.getElementById('comments-list'); // 댓글 리스트
        const footer = document.querySelector('footer .footer');       // 푸터

        // DOM 변경 이후 위치를 재계산하기 위해 약간의 지연을 추가
        setTimeout(() => {
            if (commentsList.style.display === "none") {
                // 댓글 목록이 숨겨져 있을 때: 푸터를 댓글 보기 버튼 바로 아래로 위치
                const showMoreButton = document.querySelector(".show-more-comments");
                const showMoreButtonBottom = showMoreButton.getBoundingClientRect().top + window.scrollY;
                footer.style.position = 'absolute';
                footer.style.top = `${showMoreButtonBottom + showMoreButton.offsetHeight + 600}px`; // 버튼 하단에 20px 간격
            } else {
                // 댓글 목록이 표시 중일 때: 댓글 하단에 푸터 위치
                const commentsListBottom = commentsList.getBoundingClientRect().top + window.scrollY;
                const footerTop = commentsListBottom + commentsList.scrollHeight + 20; // 댓글 목록 하단에서 20px 여백 추가
                footer.style.position = 'absolute';
                footer.style.top = `${footerTop}px`;
            }
        }, 100); // 약간의 지연을 두어 DOM 업데이트 반영
    }


    // 댓글 더보기 버튼 클릭 시 댓글 목록을 로드하거나 숨기는 함수
    // 댓글 더보기 버튼 클릭 시 댓글 목록을 로드하거나 숨기는 함수
    function loadComments() {
        const commentsList = document.getElementById("comments-list");
        const showMoreButton = document.querySelector(".show-more-comments span");

        // 댓글 목록에서 댓글 개수 확인
        const commentDivs = commentsList.querySelectorAll(".comment");

        if (commentDivs.length === 0) {
            alert("댓글이 없습니다.");
            showMoreButton.style.pointerEvents = "none"; // 클릭 비활성화
            showMoreButton.style.color = "gray"; // 비활성화된 버튼 색상 변경
            return;
        }

        // 댓글 목록이 보이지 않으면 댓글을 로드하고, 보이면 숨깁니다.
        if (commentsList.style.display === "none") {
            commentsList.style.display = "block";  // 댓글 목록을 보이게 함
            showMoreButton.textContent = "댓글 숨기기";  // 버튼 텍스트 변경

            // 댓글들을 순차적으로 처리
            const commentDivs = commentsList.querySelectorAll(".comment");
            commentDivs.forEach((commentDiv, index) => {
                // 댓글의 위치를 조정
                commentDiv.style.position = "relative";
                commentDiv.style.top = `${index * 200}px`;  // 댓글 간 간격을 150px로 설정

            });

            // 댓글 목록이 성공적으로 표시된 후 버튼 활성화
            showMoreButton.style.pointerEvents = "auto"; // 클릭 가능하게 변경
            showMoreButton.style.color = ""; // 기본 색상 복구

        } else {
            commentsList.style.display = "none";  // 댓글 목록을 숨김
            showMoreButton.textContent = "댓글 보기";  // 버튼 텍스트 변경


        }

        adjustFooterPosition();



    }

    // userNo를 JavaScript 변수에 할당
    const loggedInUserNo = [[${userNo}]] ;  // ${userNo} 값이 없을 경우 0으로 기본값 설정
    console.log("Logged In UserNo:", loggedInUserNo);  // 로그인한 사용자의 userNo 확인
    // addCommentToDOM을 외부로 이동


    function addCommentToDOM(comments, userProfileImage) {
        const commentsList = document.getElementById("comments-list");
        commentsList.innerHTML = ""; // 기존 댓글 목록을 제거하고 새로운 목록을 추가

        if (Array.isArray(comments)) {
            comments.forEach((commentWithProfile, index) => {
                const comment = commentWithProfile.comment;
                const profileImage = commentWithProfile.profileImage || '/images/mypageimages/profile.png';

                const commentDiv = document.createElement("div");
                commentDiv.classList.add("comment");
                commentDiv.style.position = "relative";
                commentDiv.style.top = `${index * 200}px`;  // 댓글 간 간격 조절

                commentDiv.innerHTML = `
                <img src="${profileImage}" alt="Profile Image" class="profile-photo2">
                <span>${comment.username}</span>
                <span>${comment.userLevel}</span>
                <span>${comment.commentContent}</span>
                <span>${comment.commentDate}</span>
                <div id="like">
                    <img src="/images/post/selectpost/like-btn-before-light.png"
                         data-comment-no="${comment.commentNo}"
                         class="likeImg"
                         style="display: ${!comment.like ? 'inline' : 'none'};"
                         onclick="toggleLike(this)">
                    <img src="/images/post/selectpost/like-btn-after.png"
                         data-comment-no="${comment.commentNo}"
                         class="likeImg"
                         style="display: ${comment.like ? 'inline' : 'none'};"
                         onclick="toggleLike(this)">
                    <div class="like-count" style="display: ${comment.likeNumber > 0 ? 'block' : 'none'};">
                        <span>${comment.likeNumber}</span>
                    </div>
                    <div class="like-text" style="display: ${comment.likeNumber === 0 ? 'block' : 'none'};">
                        <span>좋아요</span>
                    </div>
                </div>
            `;

                console.log("comment.userNo:", comment.userNo);  // 댓글 작성자 userNo 확인
                console.log("loggedInUserNo:", loggedInUserNo);  // 로그인 사용자 userNo 확인
                console.log("Comparison result:", Number(comment.userNo) === Number(loggedInUserNo));  // 비교 결과 확인



                if (Number(comment.userNo) === Number(loggedInUserNo)) {
                    const deleteButton = document.createElement("button");
                    deleteButton.classList.add("delete-comment-btn");
                    deleteButton.textContent = "삭제";
                    deleteButton.setAttribute("data-comment-no", comment.commentNo);
                    commentDiv.appendChild(deleteButton);

                    const editButton = document.createElement("button");
                    editButton.classList.add("edit-comment-btn");
                    editButton.textContent = "수정";
                    editButton.setAttribute("data-comment-no", comment.commentNo);
                    commentDiv.appendChild(editButton);
                } else {
                    const reportDiv = document.createElement("div");
                    reportDiv.innerHTML = `
<div id="report">
                    <img src="/images/post/selectpost/reportbtn-light.png" alt="Report Button">
                    <span>신고</span>
                    </div>
                `;
                    commentDiv.appendChild(reportDiv);
                }

                commentsList.appendChild(commentDiv);
            });

            // 댓글 목록이 성공적으로 표시된 후 버튼 활성화
            const showMoreButton = document.querySelector(".show-more-comments span");
            showMoreButton.style.pointerEvents = "auto"; // 클릭 가능하게 변경
            showMoreButton.style.color = ""; // 기본 색상 복구

            // 댓글 추가 후 푸터 위치 조정
            adjustFooterPosition();

        } else {
            console.error("댓글 목록을 표시할 수 없습니다. comments 배열이 아닙니다.", comments);
        }
    }


</script>

<script>
    // 무서워요 버튼 상태 변경
    function toggleScary(element) {
        const postNo = element.getAttribute('data-postNo');
        const isScary = element.getAttribute('src').includes('scary-btn-after-light.png'); // 현재 상태

        // 서버에 상태 전송
        fetch(`/toggleScary`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ postNo: postNo, isScary: !isScary })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 이미지 및 숫자 상태 업데이트
                    updateScary(element, !isScary);
                    updateScaryNumber(postNo, data.scaryNumber); // 숫자 업데이트
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // 안무서워요 버튼 상태 변경
    function toggleNotScary(element) {
        const postNo = element.getAttribute('data-postNo');
        const isNotScary = element.getAttribute('src').includes('not-scary-btn-after-light.png'); // 현재 상태

        // 서버에 상태 전송
        fetch(`/toggleNotScary`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ postNo: postNo, isNotScary: !isNotScary })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 이미지 및 숫자 상태 업데이트
                    updateNotScary(element, !isNotScary);
                    updateNotScaryNumber(postNo, data.notScaryNumber); // 숫자 업데이트
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // 무서워요 숫자 업데이트
    function updateScaryNumber(postNo, newScaryNumber) {
        const scaryNumberElement = document.querySelector(`#scary-number-${postNo}`);
        if (scaryNumberElement) {
            scaryNumberElement.textContent = newScaryNumber;
        }
    }

    // 안무서워요 숫자 업데이트
    function updateNotScaryNumber(postNo, newNotScaryNumber) {
        const notScaryNumberElement = document.querySelector(`#not-scary-number-${postNo}`);
        if (notScaryNumberElement) {
            notScaryNumberElement.textContent = newNotScaryNumber;
        }
    }

    // 무서워요 버튼 상태 업데이트
    function updateScary(element, isScary) {
        const mode = localStorage.getItem('theme-mode') || 'light'; // 현재 테마 상태 (light 또는 dark)
        const cacheBuster = `?v=${new Date().getTime()}`;  // 캐시 우회를 위한 쿼리 문자열

        // 이미지를 테마와 상태에 맞게 업데이트
        if (mode === 'dark') {
            element.setAttribute('src', isScary ? `/images/post/selectpost/scary-btn-after-dark.png${cacheBuster}` : `/images/post/selectpost/scary-btn-before-dark.png${cacheBuster}`);

        } else {
            element.setAttribute('src', isScary ? `/images/post/selectpost/scary-btn-after-light.png${cacheBuster}` : `/images/post/selectpost/scary-btn-before-light.png${cacheBuster}`);
        }
    }

    // 안무서워요 버튼 상태 업데이트
    function updateNotScary(element, isNotScary) {
        const mode = localStorage.getItem('theme-mode') || 'light'; // 현재 테마 상태 (light 또는 dark)
        const cacheBuster = `?v=${new Date().getTime()}`;  // 캐시 우회를 위한 쿼리 문자열

        // 이미지를 테마와 상태에 맞게 업데이트
        if (mode === 'dark') {
            element.setAttribute('src', isNotScary ? `/images/post/selectpost/not-scary-btn-after-dark.png${cacheBuster}` : `/images/post/selectpost/not-scary-btn-before-dark.png${cacheBuster}`);

        } else {
            element.setAttribute('src', isNotScary ? `/images/post/selectpost/not-scary-btn-after-light.png${cacheBuster}` : `/images/post/selectpost/not-scary-btn-before-light.png${cacheBuster}`);
        }
    }

    function toggleLike(element) {
        const commentNo = element.getAttribute('data-comment-no');
        const isLike = element.getAttribute('src').includes('like-btn-after.png');

        fetch('/toggleLike', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ commentNo: parseInt(commentNo), isLike: !isLike })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 테마에 맞는 이미지로 변경
                    updateLikeImage(element, isLike);

                    // 좋아요 수 업데이트
                    const likeCountContainer = element.closest('#like').querySelector('.like-count');
                    const likeTextContainer = element.closest('#like').querySelector('.like-text');

                    // 서버에서 받아온 최신 좋아요 수 반영
                    const newLikeNumber = data.likeNumber;

                    // 새로운 좋아요 수를 화면에 반영
                    likeCountContainer.querySelector('span').textContent = newLikeNumber;

                    // 텍스트와 카운트 표시 상태 전환
                    if (newLikeNumber > 0) {
                        likeTextContainer.style.display = 'none';
                        likeCountContainer.style.display = 'inline';
                    } else {
                        likeTextContainer.style.display = 'inline';
                        likeCountContainer.style.display = 'none';
                    }
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // 테마 변경 시 좋아요 이미지 업데이트
    function updateLikeImage(element, isLike) {
        const mode = localStorage.getItem('theme-mode') || 'light'; // 현재 테마 상태 (light 또는 dark)
        const cacheBuster = `?v=${new Date().getTime()}`;
        if (mode === 'dark') {
            element.setAttribute('src', isLike ? `/images/post/selectpost/like-btn-before-dark.png${cacheBuster}` : `/images/post/selectpost/like-btn-after.png${cacheBuster}`);
        } else {
            element.setAttribute('src', isLike ? `/images/post/selectpost/like-btn-before-light.png${cacheBuster}` : `/images/post/selectpost/like-btn-after.png${cacheBuster}`);
        }

        const likeCountContainer = element.closest('#like').querySelector('.like-count');
        const likeTextContainer = element.closest('#like').querySelector('.like-text');
        if (isLike) {
            likeTextContainer.style.display = 'inline';
            likeCountContainer.style.display = 'none';
        } else {
            likeCountContainer.style.display = 'inline';
            likeTextContainer.style.display = 'none';
        }
    }


    function toggleFavorite(element) {
        const postNo = element.getAttribute('data-postNo');
        const isFavorite = element.getAttribute('src').includes('best-light.png');

        fetch('/toggleFavorite', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ postNo: postNo, isFavorite: !isFavorite })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // 테마에 맞는 이미지로 변경
                    updateFavoriteImage(element, isFavorite);
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // 테마 변경 시 즐겨찾기 이미지 업데이트
    function updateFavoriteImage(element, isFavorite) {
        const mode = localStorage.getItem('theme-mode') || 'light'; // 현재 테마 상태 (light 또는 dark)

        // 테마에 맞는 이미지 경로를 설정
        const cacheBuster = `?v=${new Date().getTime()}`;  // 캐시 우회를 위한 쿼리 문자열

        if (mode === 'dark') {
            element.setAttribute('src', isFavorite ? '/images/post/best-none-dark.png' : '/images/post/best-dark.png');
        } else {
            element.setAttribute('src', isFavorite ? '/images/post/best-none-light.png' : '/images/post/best-light.png');
        }
    }


    document.addEventListener('DOMContentLoaded', () => {
        const savedMode = localStorage.getItem('theme-mode') || 'light';
        const themeStylesheet = savedMode === 'dark' ? '/css/post/selectpost-dark.css' : '/css/post/selectpost-light.css';
        const themeStylesheetMypage = savedMode === 'dark' ? '/css/mypage/mypage-dark.css' : '/css/mypage/mypage-light.css'
        document.getElementById('theme-stylesheet').setAttribute('href', themeStylesheet);
        document.getElementById('theme-stylesheet-mypage').setAttribute('href', themeStylesheetMypage);
        document.getElementById('theme-stylesheet').addEventListener('load', () => {
            updateImages(savedMode);
        });
        document.getElementById('theme-stylesheet-mypage').addEventListener('load', () => {
            updateImages(savedMode);
        });
        updateImages(savedMode);
    });
    function updateImages(mode) {
        const cacheBuster = `?v=${new Date().getTime()}`;

        const navLogo = document.getElementById('nav-logo');
        if (navLogo) {
            navLogo.setAttribute('src', mode === 'dark' ? `/images/main/nav-logo-dark.png${cacheBuster}` : `/images/main/nav-logo-light.png${cacheBuster}`);
        }

        const light = document.getElementById('light');
        if (light) {
            light.setAttribute('src', mode === 'dark' ? `/images/main/folating-btn-dark.png${cacheBuster}` : `/images/main/folating-btn-light.png${cacheBuster}`);
        }

        const dark = document.getElementById('dark');
        if (dark) {
            dark.setAttribute('src', mode === 'dark' ? `/images/main/folating-btn-click-dark.png${cacheBuster}` : `/images/main/folating-btn-click-light.png${cacheBuster}`);
        }

        const top = document.getElementById('top');
        if (top) {
            top.setAttribute('src', mode === 'dark' ? `/images/main/top-btn-dark.png${cacheBuster}` : `/images/main/top-btn-light.png${cacheBuster}`);
        }

        const modeImg = document.getElementById('mode');
        if (modeImg) {
            modeImg.setAttribute('src', mode === 'dark' ? `/images/main/light-btn-dark.png${cacheBuster}` : `/images/main/light-btn-light.png${cacheBuster}`);
        }

        const test = document.getElementById('test');
        if (test) {
            test.setAttribute('src', mode === 'dark' ? `/images/main/test-btn-dark.png${cacheBuster}` : `/images/main/test-btn-light.png${cacheBuster}`);
        }



        const scb = document.getElementById('sc-b');
        const sca = document.getElementById('sc-a');
        const nscb = document.getElementById('nsc-b');
        const nsca = document.getElementById('nsc-a');

        if (scb) {
            scb.setAttribute('src', mode === 'dark' ? `/images/post/selectpost/scary-btn-before-dark.png${cacheBuster}` : `/images/post/selectpost/scary-btn-before-light.png${cacheBuster}`);
        }
        if (sca) {
            sca.setAttribute('src', mode === 'dark' ? `/images/post/selectpost/scary-btn-after-dark.png${cacheBuster}` : `/images/post/selectpost/scary-btn-after-light.png${cacheBuster}`);
        }
        if (nscb) {
            nscb.setAttribute('src', mode === 'dark' ? `/images/post/selectpost/not-scary-btn-before-dark.png${cacheBuster}` : `/images/post/selectpost/not-scary-btn-before-light.png${cacheBuster}`);
        }
        if (nsca) {
            nsca.setAttribute('src', mode === 'dark' ? `/images/post/selectpost/not-scary-btn-after-dark.png${cacheBuster}` : `/images/post/selectpost/not-scary-btn-after-light.png${cacheBuster}`);
        }

        const fav = document.getElementById('fav');
        if (fav) {
            fav.setAttribute('src', mode === 'dark' ? `/images/post/best-dark.png${cacheBuster}` : `/images/post/best-light.png${cacheBuster}`);
        }

        const nofav = document.getElementById('nofav');
        if (nofav) {
            nofav.setAttribute('src', mode === 'dark' ? `/images/post/best-none-dark.png${cacheBuster}` : `/images/post/best-none-light.png${cacheBuster}`);
        }

        const likes = document.getElementById('likes');
        if (likes) {
            likes.setAttribute('src', mode === 'dark' ? `/images/post/selectpost/like-btn-before-dark.png${cacheBuster}` : `/images/post/selectpost/like-btn-before-light.png${cacheBuster}`);
        }

        const report = document.querySelectorAll('.report');
        if (report) {
            report.setAttribute('src', mode === 'dark' ? `/images/post/selectpost/reportbtn-dark.png${cacheBuster}` : `/images/post/selectpost/reportbtn-light.png${cacheBuster}`);
        }


    }

    // 테마 변경 시 selectpost와 mypage 모두 반영하도록
    function toggleMode() {
        const currentTheme = document.getElementById('theme-stylesheet').getAttribute('href');
        const currentThemeM = document.getElementById('theme-stylesheet-mypage').getAttribute('href');

        let newMode = '';

        // 현재 테마에 따라 새 테마 결정
        if (currentTheme.includes('selectpost-light.css')) {
            newMode = 'dark';
        } else {
            newMode = 'light';
        }

        // 테마 모드 저장
        localStorage.setItem('theme-mode', newMode);

        // selectpost와 mypage에 새로운 테마 파일을 적용
        const newTheme = newMode === 'dark' ? '/css/post/selectpost-dark.css' : '/css/post/selectpost-light.css';
        const newThemeM = newMode === 'dark' ? '/css/mypage/mypage-dark.css' : '/css/mypage/mypage-light.css';

        document.getElementById('theme-stylesheet').setAttribute('href', newTheme);
        document.getElementById('theme-stylesheet-mypage').setAttribute('href', newThemeM);

        // 테마에 맞는 이미지들 업데이트
        updateImages(newMode);
    }

</script>

<script>
    function updateThemeMode() {
        const mode = localStorage.getItem('theme-mode') || 'light'; // 현재 테마 상태 (light 또는 dark)

        // 모든 scary 버튼의 상태 업데이트
        const scaryIcons = document.querySelectorAll('.scary-icon');
        scaryIcons.forEach(icon => {
            const isScary = icon.getAttribute('data-state') === 'after';  // 현재 상태 확인
            updateScary(icon, isScary); // 이미지를 테마에 맞게 업데이트
        });

        // 모든 not scary 버튼의 상태 업데이트
        const notScaryIcons = document.querySelectorAll('.notscary-icon');
        notScaryIcons.forEach(icon => {
            const isNotScary = icon.getAttribute('data-state') === 'after';  // 현재 상태 확인
            updateNotScary(icon, isNotScary); // 이미지를 테마에 맞게 업데이트
        });
    }

    // 페이지 로드 시 테마 모드에 맞게 이미지 상태를 업데이트
    updateThemeMode();

    // 테마 변경 시 호출
    function changeThemeMode(newMode) {
        localStorage.setItem('theme-mode', newMode); // 테마 모드 저장
        updateThemeMode(); // 이미지 상태 업데이트
    }


</script>
<script>
    function toggleScary(element) {
        const postNo = element.getAttribute('data-postNo');
        const isScary = element.getAttribute('src').includes('scary-btn-after-light.png');

        fetch(`/toggleScary`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ postNo: postNo, isScary: !isScary })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    element.src = isScary ? '/images/post/selectpost/scary-btn-before-light.png' : '/images/post/selectpost/scary-btn-after-light.png';
                    document.querySelector('#scary>span').textContent = data.scaryNumber;
                }
            })
    }

    function toggleNotScary(element) {
        const postNo = element.getAttribute('data-postNo');
        const isNotScary = element.getAttribute('src').includes('not-scary-btn-after-light.png');

        fetch(`/toggleNotScary`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ postNo: postNo, isNotScary: !isNotScary })
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    element.src = isNotScary ? '/images/post/selectpost/not-scary-btn-before-light.png' : '/images/post/selectpost/not-scary-btn-after-light.png';
                    document.querySelector('#notscary>span').textContent = data.notScaryNumber;
                }
            })
    }
</script>

<script>
    window.addEventListener('load', () => {
        const box = document.getElementById('box');
        const footer = document.querySelector('footer .footer');

        const img1 = document.getElementById('img1');
        const img2 = document.getElementById('img2');
        const content = document.getElementById('content');

        let imgBottom;
        // 이미지가 두 개 다 있는 경우
        if (img1 && img1.src && img2 && img2.src) {
            imgBottom = Math.max(img1.getBoundingClientRect().bottom, img2.getBoundingClientRect().bottom);
        } else if (img1 && img1.src) {
            // 이미지가 한 개만 있는 경우
            imgBottom = img1.getBoundingClientRect().bottom;
        } else if (img2 && img2.src) {
            // 이미지가 한 개만 있는 경우
            imgBottom = img2.getBoundingClientRect().bottom;
        } else {
            // 이미지가 없는 경우
            imgBottom = 0;
        }

        const contentBottom = content.getBoundingClientRect().bottom;

        const minTop = imgBottom + 10; // 이미지 바텀 기준 값
        const contentTop = contentBottom + 10; // 콘텐츠 바텀 기준 값

        // 콘텐츠 바텀과 이미지 바텀을 비교하여 box 위치 설정
        if (contentBottom < imgBottom) {
            box.style.top = `${minTop}px`;
        }
        else {
            box.style.top = `${contentTop}px`;
        }
        adjustFooterPosition();

    });
</script>
<script>
    const floatBtn1 = document.getElementById("light");
    const floatBtn2 = document.getElementById("dark");
    const qickMenu1 =document.getElementById("top");
    const qickMenu2 =document.getElementById("mode");
    const qickMenu3 =document.getElementById("test");

    <!--플로팅 버튼 클릭시 퀵메뉴 display block-->
    floatBtn1.addEventListener('click',function (){
        floatBtn1.classList.toggle('dn');
        floatBtn2.classList.toggle('dn');
        qickMenu1.classList.toggle('dn');
        qickMenu2.classList.toggle('dn');
        qickMenu3.classList.toggle('dn');
    });


    <!--플로팅 버튼 클릭시 퀵메뉴 display none-->
    floatBtn2.addEventListener('click',function (){
        floatBtn1.classList.toggle('dn');
        floatBtn2.classList.toggle('dn');
        qickMenu1.classList.toggle('dn');
        qickMenu2.classList.toggle('dn');
        qickMenu3.classList.toggle('dn');

    });

    <!--top 버튼 클릭시 화면 상단이동-->
    setTimeout(function() {
        qickMenu1.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    }, 3000);

</script>
<script>
    function update(e){
        var x = e.clientX || e.touches[0].clientX
        var y = e.clientY || e.touches[0].clientY

        document.documentElement.style.setProperty('--cursorX', x + 'px')
        document.documentElement.style.setProperty('--cursorY', y + 'px')}

    document.addEventListener('mousemove',update)
    document.addEventListener('touchmove',update)
</script>
</body>
</html>