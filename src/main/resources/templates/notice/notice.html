<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>공지사항</title>
    <link rel="stylesheet" th:href="@{/css/reset.css}">
    <link rel="stylesheet" th:href="@{/css/notice/notice-light.css}">
</head>
<body>

<header>
    <nav>

        <!--네비바-->
        <img th:src="@{/images/main/nav-logo-dark.png}" alt="상단 로고" onclick="location.href='/'">
        <span onclick="location.href='/intro'">소개</span>
        <span onclick="location.reload()">공지사항</span>
        <span onclick="location.href='/post'">게시판</span>
        <span onclick="location.href='/mbti'">MBTI 검사</span>
        <span id="mypageBtn">마이페이지</span>
        <form th:action="@{/auth/logout}" method="post">
            <button id="logoutNav" type="submit">로그아웃</button>
        </form>
        <span onclick="location.href='/auth/signupterms'">회원가입</span>
    </nav>
</header>

<main id="mainContent">

    <div class="qickBtn">
        <!--플로팅 버튼-->
        <img th:src="@{/images/main/folating-btn-dark.png}" id="light" class="tr" alt="플로팅 버튼">
        <img th:src="@{/images/main/folating-btn-click-dark.png}" class="dn tr" id="dark" alt="플로팅 버튼 클릭">
        <div class="clikbtn tr">
            <img th:src="@{/images/main/top-btn-dark.png}" class="dn" id="top" alt="탑버튼">
            <img th:src="@{/images/main/light-btn-dark.png}" class="dn" id="mode" onclick="toggleMode()" alt="테마 변경">
            <img th:src="@{/images/main/test-btn-dark.png}" class="dn" id="test" onclick="location.href='/mbti'" alt="MBTI 테스트">
        </div>

    </div>
    <img th:src="@{/images/notice/notice-dark-box.png}" id="box">
    <img th:src="@{/images/notice/notice-dark-bg.png}" id="bg">

    <!-- 게시물 헤더 -->
    <div class="sell">
        <span class="sell-item">번호</span>
        <span class="sell-item">공지사항 제목</span>
        <span class="sell-item">카테고리</span>
        <span class="sell-item">등록날짜</span>
    </div>

    <!-- 공지사항 리스트 -->
    <div id="noticeContainer" class="notice-list">
        <!-- 데이터가 JavaScript로 동적으로 렌더링 -->
    </div>

    <!-- 페이지네이션 -->
    <div id="pagination" class="pagination">
        <!-- 페이지 버튼이 JavaScript로 동적으로 생성 -->
    </div>
</main>

<footer>
    <div class="footer">
        <p>ⓒ 2024 MergePing. All rights reserved.</p>
    </div>
</footer>



<script>
    const pageSize = 7; // 한 페이지에 표시할 공지사항 수
    let currentPage = 1; // 현재 페이지

    // 공지사항 데이터를 가져와 화면에 렌더링
    function loadNotices(page) {
        currentPage = page; // 현재 페이지 업데이트
        fetch(`/notice/data?page=${page}&pageSize=${pageSize}`)
            .then(response => response.json())
            .then(data => {
                renderNotices(data.noticeList); // 공지사항 렌더링
                renderPagination(data.currentPage, data.totalPages); // 페이지네이션 렌더링
            })
            .catch(error => console.error('Error:', error));
    }


    // 공지사항 리스트 렌더링
    function renderNotices(noticeList) {
        const noticeContainer = document.getElementById('noticeContainer');
        noticeContainer.innerHTML = ''; // 기존 공지사항 초기화

        noticeList.forEach(notice => {
            const noticeDiv = document.createElement('div');
            noticeDiv.classList.add('notice');

            // 날짜 필드 처리
            const formattedDate = notice.noticeDate
                ? new Date(notice.noticeDate).toISOString().split('T')[0]
                : "날짜 없음";

            // 공지사항 HTML 생성
            noticeDiv.innerHTML = `
          <span class="notice-item">${notice.noticeNo}</span>
          <span class="notice-item notice-title" data-id="${notice.noticeNo}">${notice.title}</span>
          <span class="notice-item">${notice.category}</span>
          <span class="notice-item">${formattedDate}</span>
      `;

            // 제목 클릭 이벤트 추가
            const titleElement = noticeDiv.querySelector('.notice-title');
            titleElement.addEventListener('click', () => {
                window.location.href = `/notice/detail/${notice.noticeNo}`;
            });

            // 컨테이너에 추가
            noticeContainer.appendChild(noticeDiv);
        });
    }

    // 페이지네이션 렌더링
    function renderPagination(currentPage, totalPages) {
        const paginationContainer = document.getElementById('pagination');
        paginationContainer.innerHTML = ''; // 기존 페이지네이션 초기화

        for (let i = 1; i <= totalPages; i++) {
            const pageButton = document.createElement('button');
            pageButton.textContent = i;
            pageButton.classList.add('pagination-btn');
            if (i === currentPage) {
                pageButton.classList.add('active'); // 현재 페이지 강조
            }

            pageButton.addEventListener('click', () => {
                if (i !== currentPage) {
                    loadNotices(i); // 선택된 페이지 번호로 데이터 로드

                    // 버튼 상태 업데이트
                    document.querySelectorAll('.pagination-btn').forEach(btn => btn.classList.remove('active'));
                    pageButton.classList.add('active');
                }
            });

            paginationContainer.appendChild(pageButton);
        }
    }

    // 초기 로드
    loadNotices(currentPage);
</script>
<script>
    function update(e){
        var x = e.clientX || e.touches[0].clientX
        var y = e.clientY || e.touches[0].clientY

        document.documentElement.style.setProperty('--cursorX', x + 'px')
        document.documentElement.style.setProperty('--cursorY', y + 'px')}

    document.addEventListener('mousemove',update)
    document.addEventListener('touchmove',update)
</script>

</body>
</html>