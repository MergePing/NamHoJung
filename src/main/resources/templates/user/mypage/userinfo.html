<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>$Title$</title>
    <link rel="stylesheet" th:href="@{/css/reset.css}">
    <link rel="stylesheet" th:href="@{/css/mypage/mypageinfo.css}">
    <link rel="stylesheet" th:href="@{/css/mainpage/mainpage-darkmode.css}">
</head>
<body>
<header>

    <nav>
        <!--ë„¤ë¹„ë°”-->
        <img th:src="@{/images/main/nav-logo-dark.png}" alt="ìƒë‹¨ ë¡œê³ " onclick="window.location.href='/'">
        <span onclick="location.href='/intro'">ì†Œê°œ</span>
        <span onclick="location.href='/notice'">ê³µì§€ì‚¬í•­</span>
        <span onclick="location.href='/post'">ê²Œì‹œíŒ</span>
        <span>MBTI ê²€ì‚¬</span>
        <span id="mypageBtn">ë§ˆì´í˜ì´ì§€</span>
        <span>ë¡œê·¸ì¸</span>
        <span>íšŒì›ê°€ì…</span>
    </nav>

</header>
    <div>
        <img class="infobackground" th:src="@{/images/mypageimages/background.png}" alt="ë‹¤í¬ëª¨ë“œ ë©”ì¸í˜ì´ì§€ ë°°ê²½í™”ë©´">
        <div class="infopopup">
            <p class="userfont">ê°œì¸ ì •ë³´</p>
            <img th:src="@{/images/mypageimages/profile.png}" alt="í”„ë¡œí•„ ì‚¬ì§„" class="profile-photo" id="profilePhoto">
            <button class="btn-upload">ì‚¬ì§„ìˆ˜ì •</button>
            <button class="btn-delete" id="btndelete">íƒˆí‡´</button>


                <div class="input-group">
                    <label class="mpname">ë‹‰ë„¤ì„</label>
                    <form action="/userinfo" method="post">
                        <input type="text" name="userName" id="nickname" th:placeholder="${myPageDTO.userName}">
                        <input type="password" name="newPassword" id="password" placeholder="ì˜ë¬¸ ìˆ«ì íŠ¹ìˆ˜ë¬¸ìë¡œ ì´ë£¨ì–´ì§„ 8~12ìë¦¬">
                        <button type="submit" class="btn-submit" id="btn-submit">ìˆ˜ì •</button>
                    </form>
                    <button class="btn-check" onclick="checkDuplicate()">ì¤‘ë³µí™•ì¸</button>
                    <div id="duplicateMessage" class="duplicatemsg" style="color: red; display: none;"></div>
                </div>


            <div class="input-group">
                <label class="mppw">ë¹„ë°€ë²ˆí˜¸</label>
                <span class="toggle-password" id="togglePassword">&#128065;</span>
                <button class="mpchange" onclick="validatePassword()">í™•ì¸</button>
                <div id="passwordFeedback" class="pwdfeedback" style="color: red; display: none;"></div>
            </div>

            <div id="confirmpopup">
                <label class="confirmno">ì¸ì¦ë²ˆí˜¸</label>
                <input type="text" id="confirm-no">
                <button class="btn-confirm1">ì¸ì¦</button>
            </div>

            <div class="input-group">
                <label class="mpemail">ì´ë©”ì¼</label>
                <input type="email" id="email" th:placeholder="${myPageDTO2.email}">
                <button class="btn-confirm" id="confirmcheck">ì¸ì¦</button>
            </div>

            <button class="btn-cancel" id="btn-cancel">ì·¨ì†Œ</button>



        </div>
        <div class="modal-background" id="modal-background">
            <div class="modifypopup" id="modify-popup">
                <p class="modifyfont">ìˆ˜ì • ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>

                <div class="popup-buttons">
                    <button id="submitdBtn" class="submitBtn">í™•ì¸</button>
                </div>

            </div>
        </div>


        <div class="modal-background2" id="modal-background2">
            <div class="deletepopup" id="deletepopup">
                <p class="deleteuser">íšŒì› íƒˆí‡´ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <p class="dangerous">íšŒì› íƒˆí‡´ ì‹œ ì¼ì£¼ì¼ê°„ì˜ ìœ ì˜ˆê¸°ê°„ì´ ìˆìœ¼ë©° 3ì¼ ì§€ë‚˜ë©´ ì˜êµ¬ ì‚­ì œ ë©ë‹ˆë‹¤.</p>
                <div>
                    <button id="cancledBtn" class="cancleBtn">ì·¨ì†Œ</button>
                </div>
                <div>
                    <button id="submitdBtn2" class="submitBtn2">í™•ì¸</button>
                </div>

            </div>
        </div>

        <div class="modal-background3" id="modal-background3">
            <div class="modifypopup" id="modify-popup2">
                <p class="deletefont">íšŒì› íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</p>

                <div class="popup-buttons">
                    <button id="submitdBtn3" class="submitBtn">í™•ì¸</button>
                </div>

            </div>
        </div>
    </div>
    <script>

        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        // ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°/ìˆ¨ê¸°ê¸° í† ê¸€
        togglePassword.addEventListener('click', () => {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            togglePassword.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ'; // ì•„ì´ì½˜ ë³€ê²½
        });

        const confirmCheck = document.getElementById('confirmcheck');
        const confirmNo= document.getElementById('confirmpopup');

        confirmCheck.addEventListener('click', () => {
            confirmNo.style.display = 'block'; // íŒì—… í‘œì‹œ
        });

        const btnCancle =document.getElementById('btn-cancel');

        btnCancle.addEventListener('click', () => {
            // URLì„ ì›í•˜ëŠ” ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš”
            location.href = '/main';
        });

        const btnsubmit = document.getElementById('btn-submit');
        const modifypopup = document.getElementById('modify-popup');
        const modal = document.querySelector('.modal-background');
        const submitBtn= document.getElementById('submitdBtn');
        // ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ìˆ˜ì • ì™„ë£Œ ëª¨ë‹¬ì°½ í‘œì‹œ ë° ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™”
        btnsubmit.addEventListener('click', (event) => {
            event.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€
            // AJAX ìš”ì²­ìœ¼ë¡œ ì„œë²„ì— ë‹‰ë„¤ì„ ìˆ˜ì • ìš”ì²­ ë³´ë‚´ê¸°
            fetch('/userinfo', {
                method: 'POST',
                body: new FormData(document.querySelector('form')) // form ë°ì´í„° ì „ì†¡
            })
                .then(response => {
                    if (response.ok) {
                        // ìš”ì²­ ì„±ê³µ ì‹œ, ìˆ˜ì • ì™„ë£Œ íŒì—…ê³¼ ëª¨ë‹¬ í‘œì‹œ
                        modifypopup.style.display = 'block';
                        modal.style.display = 'flex';
                        document.body.style.overflow = "hidden";
                    } else {
                        console.error("ìˆ˜ì • ì‹¤íŒ¨");
                    }
                })
                .catch(error => console.error("ì—ëŸ¬ ë°œìƒ:", error));
        });

        // í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ì°½ ìˆ¨ê¹€ ë° ìŠ¤í¬ë¡¤ í™œì„±í™”
        submitBtn.addEventListener('click', () => {
            // ëª¨ë‹¬ ë‹«ê¸° ë° ìŠ¤í¬ë¡¤ í™œì„±í™”
            modifypopup.style.display = 'none';
            modal.style.display = 'none';
            document.body.style.overflow = "auto";

            // í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ëŠ” ë‹¤ë¥¸ ì‘ì—… ìˆ˜í–‰ ê°€ëŠ¥
            location.href = '/main';
        });


        const btndelete = document.getElementById('btndelete');
        const deletepopup = document.getElementById('deletepopup');
        const modal2 = document.querySelector('.modal-background2');
        const submitBtn2= document.getElementById('submitdBtn2');
        const cancledBtn= document.getElementById('cancledBtn')

        //ëª¨ë‹¬
        btndelete.addEventListener('click', () => {
            deletepopup.style.display = 'block';// íšŒì›íƒˆí‡´ íŒì—… í‘œì‹œ
            document.body.style.overflow = "hidden"; // ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™”
        });

        btndelete.addEventListener("click", ()=>{
            modal2.style.display="flex";
            if (modal2.style.display === "flex") {
                cancledBtn.addEventListener("click", () => {
                    modal2.style.display = "none";
                    document.body.style.overflow = "auto"; // ìŠ¤í¬ë¡¤ ë‹¤ì‹œ í™œì„±í™”
                });
            }
        });

        submitBtn2.addEventListener('click', () => {
            // URLì„ ì›í•˜ëŠ” ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš”
            location.href = '/main';
        });

        const modifypopup2 = document.getElementById('modify-popup2');
        const modal3 = document.querySelector('.modal-background3');
        const submitdBtn3= document.getElementById('submitdBtn3');
        //ëª¨ë‹¬
        submitBtn2.addEventListener('click', () => {
            deletepopup.style.display = 'none';
            modifypopup2.style.display = 'block';// íƒˆí‡´ ì™„ë£Œ íŒì—… í‘œì‹œ
            document.body.style.overflow = "hidden"; // ìŠ¤í¬ë¡¤ ë¹„í™œì„±í™”
        });

        submitBtn2.addEventListener("click", ()=>{
            modal2.style.display = "none";
            modal3.style.display="flex";
            if (modal3.style.display === "flex") {
                submitdBtn3.addEventListener("click", () => {
                    modal3.style.display = "none";
                    document.body.style.overflow = "auto"; // ìŠ¤í¬ë¡¤ ë‹¤ì‹œ í™œì„±í™”
                });
            }
        });
        submitdBtn3.addEventListener('click', () => {
            // URLì„ ì›í•˜ëŠ” ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš”
            location.href = '/main';
        });

        function checkDuplicate() {
            const nickname = document.getElementById('nickname').value;
            const duplicateMessage = document.getElementById('duplicateMessage');

            fetch(`/checknickname?nickname=${nickname}`)
                .then(response => response.json())
                .then(data => {
                    if (data.isDuplicate) {
                        duplicateMessage.textContent = "ì¤‘ë³µëœ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤.";
                        duplicateMessage.style.color = "red";
                        btnsubmit.disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”
                    } else {
                        duplicateMessage.textContent = "ì˜¬ë°”ë¥¸ ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤.";
                        duplicateMessage.style.color = "black";
                        btnsubmit.disabled = false; // ë²„íŠ¼ í™œì„±í™”
                    }
                    duplicateMessage.style.display = "block";
                })
                .catch(error => console.error('Error:', error));
        }



        // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
        function validatePassword() {
            const newPassword = document.getElementById('password').value;
            const passwordFeedback = document.getElementById('passwordFeedback');

            // ë¹„ë°€ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
            const isValidPassword = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,12}$/.test(newPassword);

            if (isValidPassword) {
                passwordFeedback.textContent = "ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.";
                passwordFeedback.style.color = "black";
                passwordFeedback.style.display = "block";
                document.getElementById('btn-submit').disabled = false;
            } else {
                passwordFeedback.textContent = "ì˜¬ë°”ë¥´ì§€ ì•ŠëŠ” ë¹„ë°€ë²ˆí˜¸ ì…ë‹ˆë‹¤.";
                passwordFeedback.style.color = "red";
                passwordFeedback.style.display = "block";
                document.getElementById('btn-submit').disabled = true; // ë²„íŠ¼ ë¹„í™œì„±í™”
            }
        }




    </script>



</body>
</html>