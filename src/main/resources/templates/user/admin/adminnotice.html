<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>공지사항</title>
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/notice/notice.css">
</head>
<body>
<header>
  <nav>
    <img src="/images/notice/nav-logo-dark.png" alt="상단 로고" onclick="window.location.href='/'">
    <span onclick="location.href='/intro'">소개</span>
    <span onclick="location.href='/notice'">공지사항</span>
    <span onclick="location.href='/post'">게시판</span>
    <span>MBTI 검사</span>
    <span>마이페이지</span>
    <span>로그인</span>
    <span>회원가입</span>
  </nav>
</header>

<main>
  <!-- 공지사항 리스트 컨테이너 -->
  <div id="noticeContainer" class="notice-container">
    <!-- JavaScript에서 공지사항 리스트 동적으로 렌더링 -->
  </div>

  <!-- 페이지네이션 -->
  <div id="pagination" class="pagination">
    <!-- JavaScript에서 페이지 버튼 동적으로 생성 -->
  </div>
</main>

<footer>
  <div class="footer"><p>ⓒ 2024 MergePing. All rights reserved.</p></div>
</footer>

<script>
  const pageSize = 7; // 한 페이지에 표시할 공지사항 수
  let currentPage = 1; // 현재 페이지

  // 공지사항 데이터를 가져와 화면에 렌더링
  function loadNotices(page) {
    currentPage = page; // 현재 페이지 업데이트
    fetch(`/admin/notice/data?page=${page}&pageSize=${pageSize}`)
            .then(response => response.json())
            .then(data => {
              renderNotices(data.noticeList); // 공지사항 렌더링
              renderPagination(data.currentPage, data.totalPages); // 페이지네이션 렌더링
            })
            .catch(error => console.error('Error:', error));
  }

  // 공지사항 리스트 렌더링
  function renderNotices(noticeList) {
    const noticeContainer = document.getElementById('noticeContainer');
    noticeContainer.innerHTML = ''; // 기존 공지사항 초기화

    noticeList.forEach(notice => {
      const noticeDiv = document.createElement('div');
      noticeDiv.classList.add('notice');

      const formattedDate = new Date(notice.date).toISOString().split('T')[0]; // 날짜 형식 변환

      noticeDiv.innerHTML = `
            <span class="notice-item">${notice.noticeNo}</span>
            <span class="notice-item notice-title" data-id="${notice.noticeNo}">${notice.title}</span>
            <span class="notice-item">${notice.category}</span>
            <span class="notice-item">${formattedDate}</span>
        `;

      const titleElement = noticeDiv.querySelector('.notice-title');
      titleElement.addEventListener('click', () => {
        window.location.href = `/admin/notice/detail/${notice.noticeNo}`;
      });

      noticeContainer.appendChild(noticeDiv);
    });
  }

  // 페이지네이션 렌더링
  function renderPagination(currentPage, totalPages) {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = ''; // 기존 페이지네이션 초기화

    // 페이지 번호 버튼
    for (let i = 1; i <= totalPages; i++) {
      const pageButton = document.createElement('button');
      pageButton.textContent = i;
      pageButton.classList.add('pagination-button');
      if (i === currentPage) {
        pageButton.classList.add('active'); // 현재 페이지 강조
      }
      pageButton.addEventListener('click', () => loadNotices(i)); // 해당 페이지 로드
      pagination.appendChild(pageButton);
    }
  }

  // 초기 공지사항 로드
  document.addEventListener('DOMContentLoaded', () => {
    loadNotices(1);
  });
</script>
</body>
</html>