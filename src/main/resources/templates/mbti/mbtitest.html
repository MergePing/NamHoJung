<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" th:href="@{/css/mbti.css}">
  <link rel="stylesheet" th:href="@{/css/reset.css}">
</head>
<body>
<div class="resolution">
  <img class="background" th:src="@{/images/mbti/testBackground.png}" alt="mbti í…ŒìŠ¤íŠ¸ ë°°ê²½">

  <div id="loadingbarMain">
    <div id="loadingbar"></div>
  </div>

  <nav>
    <!--ë„¤ë¹„ë°”-->
    <img th:src="@{/images/main/nav-logo-dark.png}" alt="ìƒë‹¨ ë¡œê³ " onclick="location.href='/'">
    <span onclick="location.href='/intro'">ì†Œê°œ</span>
    <span onclick="location.href='/notice'">ê³µì§€ì‚¬í•­</span>
    <span onclick="location.href='/post'">ê²Œì‹œíŒ</span>
    <span onclick="location.href='/mbti'">MBTI ê²€ì‚¬</span>
    <span id="mypageBtn">ë§ˆì´í˜ì´ì§€</span>
    <form th:action="@{/auth/logout}" method="post">
      <button id="logoutNav" type="submit">ë¡œê·¸ì•„ì›ƒ</button>
    </form>
    <span onclick="location.href='/auth/signupterms'">íšŒì›ê°€ì…</span>
  </nav>
  <img id="testBack" th:src="@{/images/mbti/testBackground.png}" alt="test ì‹œì‘ ì „ ë°°ê²½">

  <img id="question-img" src="/images/mbti/img.png" alt="MBTI Image" />
  <p id="question-text" th:text="${QuestionDTO != null ? QuestionDTO.text : 'ğŸ˜‚'}"></p>

  <img class="hands" th:src="@{/images/mbti/hands.png}" alt="ì†">
  <form th:action="@{/mbti/submitMbtiResult}" method="post">
  <button class="next" type="button" id="yes" onclick="answerQuestion('yes')" data-content="ì˜ˆ">ì˜ˆ</button>
  <button class="next" type="button" id="no" onclick="answerQuestion('no')" data-content="ì•„ë‹ˆì˜¤">ì•„ë‹ˆì˜¤</button>
  </form>
</div>
</body>
<script>
  class MbtiTesterDTO {
    constructor() {
      this.CB = 0;
      this.HG = 0;
      this.SE = 0;
      this.TM = 0;
    }

    updateMbti(questionNo, answer) {
      if (questionNo >= 1 && questionNo <= 9) {
        if (answer === "yes") {
          this.CB++;
        } else if (answer === "no") {
          this.CB--;
        }
      } else if (questionNo >= 10 && questionNo <= 18) {
        if (answer === "yes") {
          this.HG++;
        } else if (answer === "no") {
          this.HG--;
        }
      } else if (questionNo >= 19 && questionNo <= 27) {
        if (answer === "yes") {
          this.SE++;
        } else if (answer === "no") {
          this.SE--;
        }
      } else if (questionNo >= 28 && questionNo <= 36) {
        if (answer === "yes") {
          this.TM++;
        } else if (answer === "no") {
          this.TM--;
        }
      }
    }
    toString() {
      return `MbtiTester{CB=${this.CB}, HG=${this.HG}, SE=${this.SE}, TM=${this.TM}}`;
    }
  }

  function submitMbtiResult() {
    fetch('/mbti/submitmbtiresult', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        CB: mbtiTesterDTO.CB,
        HG: mbtiTesterDTO.HG,
        SE: mbtiTesterDTO.SE,
        TM: mbtiTesterDTO.TM
      })
    })
            .then(response => response.json())
            .then(data => {
              location.href = '/mbti/mbtiresult';
            })
            .catch(error => console.error('Error submitting MBTI result:', error));
  }
  const totalQuestions = 36; // ë³€í•˜ì§€ ì•Šì„ê±°ë‹ˆê¹Œ const
  let currentQuestionNo = 1; // ë³€í•´ì•¼ í•˜ë‹ˆê¹Œ let
  const mbtiTesterDTO = new MbtiTesterDTO(); // ê²°ê³¼ë‹´ì„ ê³µê°„

  function updateLoadingBar() {
    const progress = (currentQuestionNo - 1) / totalQuestions * 100;
    document.getElementById("loadingbar").style.width = progress + "%";
  }

  function answerQuestion(answer) {

    if (currentQuestionNo === 37) {
      submitMbtiResult();
      return;
    }

    updateLoadingBar();

    mbtiTesterDTO.updateMbti(currentQuestionNo, answer);
    const imagePath = `/images/mbti/questions/mbti${currentQuestionNo}img.png`;
    fetch(`/mbti/question/${currentQuestionNo}`)
            .then(response => response.json())
            .then(data => {
              document.getElementById("question-text").textContent = data.text;
              // document.getElementById("question-img").src = '/images/mbti/questions/' + data.image; // dbê²½ë¡œë¡œ í•˜ë ¤ê³ í–ˆëŠ”ë° ì•ˆë¼ì„œ ë°”ê¿ˆ - ì´ ì¤„ì€ dbë„£ì„ë•Œ ì‚¬ìš©
              document.getElementById("question-img").src = imagePath;
              currentQuestionNo++;
            })
            .catch(error => console.error('Error fetching data:', error));
    console.log(mbtiTesterDTO.toString());
  }
</script>
</html>