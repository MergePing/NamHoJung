<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" th:href="@{/css/mbti.css}">
  <link rel="stylesheet" th:href="@{/css/reset.css}">
</head>
<body>
<div class="resolution">
  <img class="background" th:src="@{/images/mbti/testBackground.png}" alt="mbti 테스트 배경">
  <nav>
    <!--네비바-->
    <img th:src="@{/images/main/nav-logo-dark.png}" alt="상단 로고" onclick="location.href='/'">
    <span onclick="location.href='/intro'">소개</span>
    <span onclick="location.href='/notice'">공지사항</span>
    <span onclick="location.href='/post'">게시판</span>
    <span onclick="location.href='/mbti'">MBTI 검사</span>
    <span id="mypageBtn">마이페이지</span>
    <form th:action="@{/auth/logout}" method="post">
      <button id="logoutNav" type="submit">로그아웃</button>
    </form>
    <span onclick="location.href='/auth/signupterms'">회원가입</span>
  </nav>
  <img id="testBack" th:src="@{/images/mbti/testBackground.png}" alt="test 시작 전 배경">


  <img id="question-img" src="/images/mbti/img.png" alt="MBTI Image" />
  <p id="question-text" th:text="${questiondto != null ? questiondto.text : '시작하기'}"></p>

  <img class="hands" th:src="@{/images/mbti/hands.png}" alt="손">
  <button type="button" class="next" id="yes" onclick="answerQuestion('yes')" data-content="예">예</button>
  <button type="button" class="next" id="no" onclick="answerQuestion('no')" data-content="아니오">아니오</button>
</div>
</body>
<script>

  // MbtiTesterDTO 정의
  class MbtiTesterDTO {
    constructor() {
      this.CB = 0;
      this.HG = 0;
      this.SE = 0;
      this.TM = 0;
    }

    // 문제 번호에 따라 각 카테고리의 점수를 업데이트하는 메소드
    updateMbti(questionNo, answer) {
      if (questionNo >= 1 && questionNo <= 9) { // CB 카테고리 (1~9번)
        if (answer === "yes") {
          this.CB++;
        } else if (answer === "no") {
          this.CB--;
        }
      } else if (questionNo >= 10 && questionNo <= 18) { // HG 카테고리 (10~18번)
        if (answer === "yes") {
          this.HG++;
        } else if (answer === "no") {
          this.HG--;
        }
      } else if (questionNo >= 19 && questionNo <= 27) { // SE 카테고리 (19~27번)
        if (answer === "yes") {
          this.SE++;
        } else if (answer === "no") {
          this.SE--;
        }
      } else if (questionNo >= 28 && questionNo <= 36) { // TM 카테고리 (28~36번)
        if (answer === "yes") {
          this.TM++;
        } else if (answer === "no") {
          this.TM--;
        }
      }
    }

    // 점수를 출력할 수 있는 메소드
    toString() {
      return `MbtiTester{CB=${this.CB}, HG=${this.HG}, SE=${this.SE}, TM=${this.TM}}`;
    }
  }

  let currentQuestionNo = 1;
  const mbtiTesterDTO = new MbtiTesterDTO(); // 결과담을 공간

  // '예' 또는 '아니오' 버튼 클릭 시 호출되는 함수
  function answerQuestion(answer) {
    mbtiTesterDTO.updateMbti(currentQuestionNo, answer);
    const imagePath = `/images/mbti/questions/mbti${currentQuestionNo}img.png`;
    // 서버로 비동기 요청 보내기
    fetch(`/mbti/question/${currentQuestionNo}`)
            .then(response => response.json())
            .then(data => {
              document.getElementById("question-text").textContent = data.text;
              // 문제 이미지 업데이트
              // document.getElementById("question-img").src = '/images/mbti/questions/' + data.image; // db경로로 하려고했는데 안돼서 바꿈 - 이 줄은 db넣을때 사용
              document.getElementById("question-img").src = imagePath;
              // 문제 번호 증가
              currentQuestionNo++;
            })
            .catch(error => console.error('Error fetching data:', error));
    console.log(mbtiTesterDTO.toString());
  }
</script>
</html>